<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>GitHub Author Search</title>

  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>
  <link rel="stylesheet" href="build/tailwind.css">
</head>
<body class="bg-gray-50">

<div class="relative overflow-hidden">
  <!-- start:patterns -->
  <div class="hidden sm:block sm:absolute sm:inset-y-0 sm:h-full sm:w-full" aria-hidden="true">
    <div class="relative h-full max-w-7xl mx-auto">
      <svg class="absolute right-full transform translate-y-1/4 translate-x-1/4 lg:translate-x-1/2" width="404" height="784" fill="none" viewBox="0 0 404 784">
        <defs>
          <pattern id="f210dbf6-a58d-4871-961e-36d5016a0f49" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
            <rect x="0" y="0" width="4" height="4" class="text-gray-200" fill="currentColor" />
          </pattern>
        </defs>
        <rect width="404" height="784" fill="url(#f210dbf6-a58d-4871-961e-36d5016a0f49)" />
      </svg>
      <svg class="absolute left-full transform -translate-y-3/4 -translate-x-1/4 md:-translate-y-1/2 lg:-translate-x-1/2" width="404" height="784" fill="none" viewBox="0 0 404 784">
        <defs>
          <pattern id="5d0dd344-b041-4d26-bec4-8d33ea57ec9b" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
            <rect x="0" y="0" width="4" height="4" class="text-gray-200" fill="currentColor" />
          </pattern>
        </defs>
        <rect width="404" height="784" fill="url(#5d0dd344-b041-4d26-bec4-8d33ea57ec9b)" />
      </svg>
    </div>
  </div>
  <!-- end:patterns -->

  <div class="relative pt-6 pb-16 sm:pb-24">
    <main class="mt-16 mx-auto max-w-7xl px-4 sm:mt-24">
      <!-- start:hero -->
      <div class="text-center">
        <h1 class="text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl">
          <span class="block xl:inline">GitHub Author </span>
          <span class="block text-indigo-600 xl:inline">Search</span>
        </h1>
        <p class="mt-3 max-w-md mx-auto text-base text-gray-500 sm:text-lg md:mt-5 md:text-xl md:max-w-3xl">
          Enter the GitHub User's name and retrieve their full name, avatar and GitHub email address.
        </p>
      </div>
      <!-- end:hero -->

      <div class="max-w-xl mx-auto md:mt-8" x-data="userSearch()">
        <!-- start:form -->
        <form action="#" class="w-full flex flex-col" @submit.prevent="fetchUser()">
          <div class="flex rounded-md shadow-sm">
            <div class="relative flex items-stretch flex-grow focus-within:z-10">
              <input
                  type="search"
                  name="search"
                  id="search"
                  x-model="search"
                  class="focus:ring-indigo-500 focus:border-indigo-500 block w-full rounded-none rounded-l-md sm:text-sm border-gray-300"
                  placeholder="octocat"
                  autocomplete="off"
              />
            </div>
            <button
                type="submit"
                class="-ml-px relative inline-flex items-center md:space-x-2 px-4 py-2 border border-gray-300 text-sm font-medium rounded-r-md text-gray-700 bg-gray-50 focus:outline-none focus:ring-1 focus:ring-indigo-300 focus:border-indigo-300 group"
                :class="[ isLoading ? 'opacity-50 cursor-not-allowed' : 'hover:bg-indigo-500 hover:text-white hover:border-indigo-500' ]"
                :disabled="isLoading"
            >
              <svg class="hidden md:block h-4 w-4 text-gray-400 group-hover:text-gray-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <span>Search</span>
            </button>
          </div>
        </form>
        <!-- end:form -->

        <!-- start:error -->
        <template x-if="error">
          <div x-text="error" class="text-red-500"></div>
        </template>
        <!-- end:error -->

        <!-- start:result -->
        <ol class="mt-4 text-left space-y-4" reversed>
          <template x-for="user in users()" :key="user.id">
            <li class="flex items-center">
              <div class="hidden md:block md:mr-4">
                <img class="rounded w-16 h-16" :src="user.avatar_url" alt="">
              </div>
              <div>
                <h3 class="text-gray-900 font-bold leading-none mb-2" x-text="user.login"></h3>
                <code class="block mt-2 text-xs" x-text='`${user.name} <${user.id}+${user.login}@users.noreply.github.com>`'></code>
              </div>
            </li>
          </template>
        </ol>
        <!-- end:result -->
      </div>
    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@ryangjchandler/spruce@2.x.x/dist/spruce.umd.js"></script>
<script type="text/javascript">
  Spruce.store('github', {
    users: []
  }, true);

  function userSearch() {
    return {
      search: null,
      isLoading: false,
      error: null,
      users() {
        return JSON.parse(JSON.stringify(this.$store.github.users)).reverse();
      },
      fetchUser() {
        this.isLoading = true;
        if(this.search === null || this.search.trim() === '') {
          this.error = 'You have to enter a GitHub username';
          return;
        }

        fetch(`https://api.github.com/users/${this.search}`)
            .then((res) => res.json())
            .then((data) => {
              this.isLoading = false;

              if(typeof data.id === 'undefined') {
                this.error = 'No user found';
                return;
              }

              if(data.type !== 'User') {
                this.error = 'You can only author users';
                return;
              }

              this.addUser(data);

              this.error = null;
            });
      },
      addUser(data) {
        Spruce.store('github').users = Spruce.store('github').users.filter(user => user.id !== data.id);

        Spruce.store('github').users.push({
          id: data.id,
          login: data.login,
          name: data.name,
          avatar_url: data.avatar_url,
        });

        Spruce.store('github').users = Spruce.store('github').users.slice(-10);
      }
    };
  }
</script>
</body>
</html>